<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motorcontrol wellplate reader: lib.imageProcessor.WellPositionEvaluator Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motorcontrol wellplate reader
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00114.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="a00111.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">lib.imageProcessor.WellPositionEvaluator Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>class <a class="el" href="a00114.html" title="class WellPositionEvaluator evaluates the position of circles in the passed image relative to the tar...">WellPositionEvaluator</a> evaluates the position of circles in the passed image relative to the target position.  
 <a href="a00114.html#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for lib.imageProcessor.WellPositionEvaluator:</div>
<div class="dyncontent">
<div class="center"><img src="a00113.png" border="0" usemap="#lib_8image_processor_8_well_position_evaluator_inherit__map" alt="Inheritance graph"/></div>
<map name="lib_8image_processor_8_well_position_evaluator_inherit__map" id="lib_8image_processor_8_well_position_evaluator_inherit__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for lib.imageProcessor.WellPositionEvaluator:</div>
<div class="dyncontent">
<div class="center"><img src="a00112.png" border="0" usemap="#lib_8image_processor_8_well_position_evaluator_coll__map" alt="Collaboration graph"/></div>
<map name="lib_8image_processor_8_well_position_evaluator_coll__map" id="lib_8image_processor_8_well_position_evaluator_coll__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa28482b28ac5b76d23bf1adb5341bb6d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00114.html#aa28482b28ac5b76d23bf1adb5341bb6d">__init__</a> (self, resolution)</td></tr>
<tr class="separator:aa28482b28ac5b76d23bf1adb5341bb6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ed6831838aa66e97785d4464822d644"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00114.html#a8ed6831838aa66e97785d4464822d644">evaluate</a> (self, source, target=(0, 0))</td></tr>
<tr class="memdesc:a8ed6831838aa66e97785d4464822d644"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="a00114.html#a8ed6831838aa66e97785d4464822d644" title="WellPositionEvaluator::evaluate(self, source, target=(0,0)) finds the position error by finding the w...">WellPositionEvaluator::evaluate</a>(self, source, target=(0,0)) finds the position error by finding the well bottom centroid.  <a href="#a8ed6831838aa66e97785d4464822d644">More...</a><br /></td></tr>
<tr class="separator:a8ed6831838aa66e97785d4464822d644"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79edd407683d50b00ada07723565fb25"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00114.html#a79edd407683d50b00ada07723565fb25">wait_ms</a> (self, milliseconds)</td></tr>
<tr class="memdesc:a79edd407683d50b00ada07723565fb25"><td class="mdescLeft">&#160;</td><td class="mdescRight">WellPositionEvaluator::wait_ms(self, milliseconds) is a delay function.  <a href="#a79edd407683d50b00ada07723565fb25">More...</a><br /></td></tr>
<tr class="separator:a79edd407683d50b00ada07723565fb25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a689d82ade48b014ac559582019e6080f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00114.html#a689d82ade48b014ac559582019e6080f">stop</a> (self)</td></tr>
<tr class="separator:a689d82ade48b014ac559582019e6080f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d886a12b93d05378cda6efb420513cd"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00114.html#a2d886a12b93d05378cda6efb420513cd">close</a> (self)</td></tr>
<tr class="separator:a2d886a12b93d05378cda6efb420513cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:aaef00c5c37bba1351db8bccfc05ce89b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00114.html#aaef00c5c37bba1351db8bccfc05ce89b">img_width</a></td></tr>
<tr class="separator:aaef00c5c37bba1351db8bccfc05ce89b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1225f5da7b3021aeb6fcbd4f4d79031"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00114.html#aa1225f5da7b3021aeb6fcbd4f4d79031">img_height</a></td></tr>
<tr class="separator:aa1225f5da7b3021aeb6fcbd4f4d79031"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa77e0074edecc58a5853ba40fe1d46b6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00114.html#aa77e0074edecc58a5853ba40fe1d46b6">circle_minRadius</a></td></tr>
<tr class="separator:aa77e0074edecc58a5853ba40fe1d46b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c62ff054b72926766958ec5f5f29f5e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00114.html#a1c62ff054b72926766958ec5f5f29f5e">circle_maxRadius</a></td></tr>
<tr class="separator:a1c62ff054b72926766958ec5f5f29f5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a469ee1231630fe3547574272f64018"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00114.html#a5a469ee1231630fe3547574272f64018">circle_minDistance</a></td></tr>
<tr class="separator:a5a469ee1231630fe3547574272f64018"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>class <a class="el" href="a00114.html" title="class WellPositionEvaluator evaluates the position of circles in the passed image relative to the tar...">WellPositionEvaluator</a> evaluates the position of circles in the passed image relative to the target position. </p>
<dl class="section author"><dt>Author</dt><dd>Robin Meekers </dd></dl>

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00136">136</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="aa28482b28ac5b76d23bf1adb5341bb6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa28482b28ac5b76d23bf1adb5341bb6d">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def lib.imageProcessor.WellPositionEvaluator.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>resolution</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00143">143</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keyword">def </span><a class="code" href="a00158.html#ad739316aec69065cbf258b550efc3c04">__init__</a>(self, resolution):</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        super().<a class="code" href="a00158.html#ad739316aec69065cbf258b550efc3c04">__init__</a>()</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        self.img_width, self.img_height = resolution</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment"># The radius&#39; are just initial values and will be reset once the first circle was found at the home position.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        self.circle_maxRadius = int((self.img_height/2)) <span class="comment"># maximum circle radius is one that covers the entire height</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        self.circle_minRadius = int((self.img_height/2) * 0.7) <span class="comment"># minimum circle size covers 70% of img height</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        self.circle_minDistance = int(self.img_height/480) <span class="comment"># find as many circles as reasonably possible</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="ttc" id="a00158_html_ad739316aec69065cbf258b550efc3c04"><div class="ttname"><a href="a00158.html#ad739316aec69065cbf258b550efc3c04">stepper.StepperWellPositioning.__init__</a></div><div class="ttdeci">def __init__(self, steppers, Well_data)</div><div class="ttdoc">StepperWellPositioning()::init initialises the stepper objects for X and Y axis and initialises the g...</div><div class="ttdef"><b>Definition:</b> <a href="a00068_source.html#l00289">stepper.py:289</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a2d886a12b93d05378cda6efb420513cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d886a12b93d05378cda6efb420513cd">&#9670;&nbsp;</a></span>close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def lib.imageProcessor.WellPositionEvaluator.close </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00240">240</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keyword">def </span><a class="code" href="a00158.html#a293f3b2046fb9944579e5ec29ce1a636">close</a>(self):</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        print(<span class="stringliteral">&quot;WellPositionEvaluator::close thread check: &quot;</span> + str(QThread.currentThread()))</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        self.stop()</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        self.exit(0)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">return</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<div class="ttc" id="a00158_html_a293f3b2046fb9944579e5ec29ce1a636"><div class="ttname"><a href="a00158.html#a293f3b2046fb9944579e5ec29ce1a636">stepper.StepperWellPositioning.close</a></div><div class="ttdeci">def close(self)</div><div class="ttdef"><b>Definition:</b> <a href="a00068_source.html#l00581">stepper.py:581</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00114_a2d886a12b93d05378cda6efb420513cd_cgraph.png" border="0" usemap="#a00114_a2d886a12b93d05378cda6efb420513cd_cgraph" alt=""/></div>
<map name="a00114_a2d886a12b93d05378cda6efb420513cd_cgraph" id="a00114_a2d886a12b93d05378cda6efb420513cd_cgraph">
<area shape="rect" id="node2" href="a00110.html#a89f32c6c9fd642eaf2ad70f02012b25e" title="lib.imageProcessor.Image\lProcessor.stop" alt="" coords="303,64,492,105"/>
<area shape="rect" id="node5" href="a00114.html#a689d82ade48b014ac559582019e6080f" title="lib.imageProcessor.WellPosition\lEvaluator.stop" alt="" coords="283,191,512,232"/>
<area shape="rect" id="node3" href="a00098.html#ae279bd7688a26a8916a510b94f835d9b" title="BatchProcessor()::msg emits the message signal. " alt="" coords="560,71,820,98"/>
<area shape="rect" id="node4" href="a00110.html#a8824b021d1073ab7ae85961f9ebab10c" title="ImageProcessor::msg(self, message) emits the message signal. " alt="" coords="595,5,785,47"/>
<area shape="rect" id="node6" href="a00122.html#abdf76061e78e1425a6bdb916fea35d0c" title="Manipulator::msg(self, message) emits the message signal. " alt="" coords="575,426,805,453"/>
<area shape="rect" id="node7" href="a00130.html#a0c13c8b87b8bce9804cd4f3cec6932dd" title="PiVideoStream::msg(self, message) emits the message signal. " alt="" coords="582,122,798,149"/>
<area shape="rect" id="node8" href="a00142.html#a4db49242c58dc387dcc5a7eeb4a7c6f5" title="Mainwindow(QDialog)::msg(self, message) emits the message signal. " alt="" coords="604,173,776,199"/>
<area shape="rect" id="node9" href="a00146.html#aa95c49c767c016c2511deb0b00879a13" title="Scanner()::msg(self, message) emits the message signal. " alt="" coords="619,223,761,250"/>
<area shape="rect" id="node10" href="a00150.html#a5af9ab4402a492d8167713de7a9346fe" title="GcodeSerial::msg(self, message) emits the message signal. " alt="" coords="575,274,805,301"/>
<area shape="rect" id="node11" href="a00154.html#aa8dc51da2ee0fb7516b6387af022c54b" title="StepperControl::msg(self, message) emits the message signal. " alt="" coords="589,325,791,351"/>
<area shape="rect" id="node12" href="a00158.html#a3df1009dce7f51cfe60dcc2970d3d7ca" title="StepperWellPositioning()::msg emits the message signal. " alt="" coords="562,375,818,402"/>
</map>
</div>

</div>
</div>
<a id="a8ed6831838aa66e97785d4464822d644"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ed6831838aa66e97785d4464822d644">&#9670;&nbsp;</a></span>evaluate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def lib.imageProcessor.WellPositionEvaluator.evaluate </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>target</em> = <code>(0,&#160;0)</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="a00114.html#a8ed6831838aa66e97785d4464822d644" title="WellPositionEvaluator::evaluate(self, source, target=(0,0)) finds the position error by finding the w...">WellPositionEvaluator::evaluate</a>(self, source, target=(0,0)) finds the position error by finding the well bottom centroid. </p>
<p>Find circle(s) using hough transform, and return the circle that is closest to the centre. If no circle could be found decrease param2 and increase contrast, though this might cause false negatives if it is too low. When this still fails, use blob detection and attempt to find a circle like object. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>2d grayscale image list </td></tr>
    <tr><td class="paramname">target</td><td>contains the target coordinates (topleft pixel is 0,0) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>offset tuple (x, y) position error </dd></dl>

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00158">158</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keyword">def </span>evaluate(self, source, target=(0, 0)):</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        error = <span class="keywordtype">None</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        best_match = <span class="keywordtype">None</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        best_area = <span class="keywordtype">None</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        best_radius = <span class="keywordtype">None</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        img = source.copy()</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        </div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        cv2.normalize(img, img, 0, 255, cv2.NORM_MINMAX)</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        clahe = cv2.createCLAHE(clipLimit=4.0, tileGridSize=(8, 8))</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        img = clahe.apply(img)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        circles = cv2.HoughCircles(image=img, method=cv2.HOUGH_GRADIENT, dp=1, param1=40, param2=80, minDist=self.circle_minDistance, minRadius=self.circle_minRadius, maxRadius=self.circle_maxRadius)</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> circles <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            circles = np.round(circles[0, :]).astype(<span class="stringliteral">&quot;int&quot;</span>)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            </div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            best_radius = 0</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">for</span> (x, y, r) <span class="keywordflow">in</span> circles:</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                target_error = np.subtract((x,y), target)</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordflow">if</span> best_radius &lt; r:</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                    best_match = target_error</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                    best_area = int(math.pi * r * r)</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                    best_radius = r </div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            error = (best_match, best_area, best_radius)</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="comment">#print(&quot;Found (hough): &quot; + str(error))</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="keywordflow">return</span> error</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        </div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        cv2.threshold(img, 200, 255, cv2.THRESH_OTSU, img)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="comment"># Morph-close with a small kernel to close holes caused by objects within the well.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (int(self.img_width / 128), int(self.img_height / 128)))</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        cv2.morphologyEx(img, cv2.MORPH_CLOSE, kernel, img, (-1, -1), 2)</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        </div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        best_score = sys.maxsize</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">#_,contours,_ = cv2.findContours(img, cv2.RETR_LIST, cv2.CHAIN_APPROX_SIMPLE)</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        contours,_ = cv2.findContours(img, cv2.RETR_LIST, cv2.CHAIN_APPROX_SIMPLE)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">for</span> i, c <span class="keywordflow">in</span> enumerate(contours):</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            area = cv2.contourArea(c)</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keywordflow">if</span> area &gt; int((self.img_width/3) * (self.img_height/3)):</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                perimeter = cv2.arcLength(c, <span class="keyword">True</span>)</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                roundness = 4 * np.pi * area / perimeter ** 2</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                m = cv2.moments(c)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                eccentricity = ((m[<span class="stringliteral">&#39;nu20&#39;</span>] - m[<span class="stringliteral">&#39;nu02&#39;</span>]) ** 2 + 4 * m[<span class="stringliteral">&#39;nu11&#39;</span>] ** 2) / (m[<span class="stringliteral">&#39;nu20&#39;</span>] + m[<span class="stringliteral">&#39;nu02&#39;</span>]) ** 2</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                score = (1 - roundness + eccentricity) / 2</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <span class="keywordflow">if</span> score &lt; best_score:</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                    best_score = score</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    best_match = c</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                    best_area = int(area)</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                    best_radius = int(math.sqrt(area/np.pi))</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">if</span> best_match <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            M = cv2.moments(best_match)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            cX = int(M[<span class="stringliteral">&quot;m10&quot;</span>] / M[<span class="stringliteral">&quot;m00&quot;</span>] + 0.5)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            cY = int(M[<span class="stringliteral">&quot;m01&quot;</span>] / M[<span class="stringliteral">&quot;m00&quot;</span>] + 0.5)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            centroid = (cX, cY)</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            best_match = np.subtract(centroid, target)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            error = (best_match, best_area, best_radius)</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keywordflow">return</span> (error)</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="keywordflow">return</span> 0, 0, -1, -1</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a689d82ade48b014ac559582019e6080f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a689d82ade48b014ac559582019e6080f">&#9670;&nbsp;</a></span>stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def lib.imageProcessor.WellPositionEvaluator.stop </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00234">234</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keyword">def </span>stop(self):</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">if</span> self.isRunning():</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            self.msg(<span class="stringliteral">&#39;I: Stopping worker &quot;{}&quot;\n&#39;</span>.format(self.name))</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            self.quit()</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00114_a689d82ade48b014ac559582019e6080f_cgraph.png" border="0" usemap="#a00114_a689d82ade48b014ac559582019e6080f_cgraph" alt=""/></div>
<map name="a00114_a689d82ade48b014ac559582019e6080f_cgraph" id="a00114_a689d82ade48b014ac559582019e6080f_cgraph">
<area shape="rect" id="node2" href="a00098.html#ae279bd7688a26a8916a510b94f835d9b" title="BatchProcessor()::msg emits the message signal. " alt="" coords="283,5,543,32"/>
<area shape="rect" id="node3" href="a00110.html#a8824b021d1073ab7ae85961f9ebab10c" title="ImageProcessor::msg(self, message) emits the message signal. " alt="" coords="318,57,507,98"/>
<area shape="rect" id="node4" href="a00122.html#abdf76061e78e1425a6bdb916fea35d0c" title="Manipulator::msg(self, message) emits the message signal. " alt="" coords="297,123,528,149"/>
<area shape="rect" id="node5" href="a00130.html#a0c13c8b87b8bce9804cd4f3cec6932dd" title="PiVideoStream::msg(self, message) emits the message signal. " alt="" coords="305,173,521,200"/>
<area shape="rect" id="node6" href="a00142.html#a4db49242c58dc387dcc5a7eeb4a7c6f5" title="Mainwindow(QDialog)::msg(self, message) emits the message signal. " alt="" coords="327,224,499,251"/>
<area shape="rect" id="node7" href="a00146.html#aa95c49c767c016c2511deb0b00879a13" title="Scanner()::msg(self, message) emits the message signal. " alt="" coords="342,275,483,301"/>
<area shape="rect" id="node8" href="a00150.html#a5af9ab4402a492d8167713de7a9346fe" title="GcodeSerial::msg(self, message) emits the message signal. " alt="" coords="297,325,528,352"/>
<area shape="rect" id="node9" href="a00154.html#aa8dc51da2ee0fb7516b6387af022c54b" title="StepperControl::msg(self, message) emits the message signal. " alt="" coords="311,376,514,403"/>
<area shape="rect" id="node10" href="a00158.html#a3df1009dce7f51cfe60dcc2970d3d7ca" title="StepperWellPositioning()::msg emits the message signal. " alt="" coords="285,427,541,453"/>
</map>
</div>

</div>
</div>
<a id="a79edd407683d50b00ada07723565fb25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79edd407683d50b00ada07723565fb25">&#9670;&nbsp;</a></span>wait_ms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def lib.imageProcessor.WellPositionEvaluator.wait_ms </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>milliseconds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>WellPositionEvaluator::wait_ms(self, milliseconds) is a delay function. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">milliseconds</td><td>is the number of milliseconds to wait. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00227">227</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keyword">def </span><a class="code" href="a00158.html#a833bad880426b011598d9a2734d75ebf">wait_ms</a>(self, milliseconds):</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        GeneralEventLoop = QEventLoop()</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        QTimer.singleShot(milliseconds, GeneralEventLoop.exit)</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        GeneralEventLoop.exec_()</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">return</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="ttc" id="a00158_html_a833bad880426b011598d9a2734d75ebf"><div class="ttname"><a href="a00158.html#a833bad880426b011598d9a2734d75ebf">stepper.StepperWellPositioning.wait_ms</a></div><div class="ttdeci">def wait_ms(self, milliseconds)</div><div class="ttdoc">StepperWellPositioning()::wait_ms(self, milliseconds) is a delay function. </div><div class="ttdef"><b>Definition:</b> <a href="a00068_source.html#l00325">stepper.py:325</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a1c62ff054b72926766958ec5f5f29f5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c62ff054b72926766958ec5f5f29f5e">&#9670;&nbsp;</a></span>circle_maxRadius</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">lib.imageProcessor.WellPositionEvaluator.circle_maxRadius</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00140">140</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>

</div>
</div>
<a id="a5a469ee1231630fe3547574272f64018"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a469ee1231630fe3547574272f64018">&#9670;&nbsp;</a></span>circle_minDistance</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">lib.imageProcessor.WellPositionEvaluator.circle_minDistance</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00141">141</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>

</div>
</div>
<a id="aa77e0074edecc58a5853ba40fe1d46b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa77e0074edecc58a5853ba40fe1d46b6">&#9670;&nbsp;</a></span>circle_minRadius</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">lib.imageProcessor.WellPositionEvaluator.circle_minRadius</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00139">139</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>

</div>
</div>
<a id="aa1225f5da7b3021aeb6fcbd4f4d79031"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1225f5da7b3021aeb6fcbd4f4d79031">&#9670;&nbsp;</a></span>img_height</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">lib.imageProcessor.WellPositionEvaluator.img_height</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00138">138</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>

</div>
</div>
<a id="aaef00c5c37bba1351db8bccfc05ce89b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaef00c5c37bba1351db8bccfc05ce89b">&#9670;&nbsp;</a></span>img_width</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">lib.imageProcessor.WellPositionEvaluator.img_width</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00047_source.html#l00137">137</a> of file <a class="el" href="a00047_source.html">imageProcessor.py</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="a00047_source.html">imageProcessor.py</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00077.html">lib</a></li><li class="navelem"><a class="el" href="a00081.html">imageProcessor</a></li><li class="navelem"><a class="el" href="a00114.html">WellPositionEvaluator</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
